<html>
<head>
</head>
<body>
<div class="grid">
  <div id="group-1">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
    <div id="group-2">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-3">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-4">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-5">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-6">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-7">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-8">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-9">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-10">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-11">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-12">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-13">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-14">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-15">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
  <div id="group-16">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
  </div>
</div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>
<script>
//http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/
//http://www.softsynth.com/webaudio/tone.php
//http://noisehack.com/custom-audio-effects-javascript-web-audio-api/
// https://chromium.googlesource.com/external/WebKit_LayoutTests/+/master/webaudio/audiobuffersource-playbackrate.html

var noteCatalogue=[];
var gainNode, oscillator;
var sampleRate = 44100.0;
var frequency = 440.0

function createSoundBuffer() {
    var duration = 1 / frequency;
    var sampleFrameLength = duration * sampleRate;
    
    var audioBuffer = context.createBuffer(2, sampleFrameLength, sampleRate);
    var n = audioBuffer.length;
    var channelL = audioBuffer.getChannelData(0);
    var channelR = audioBuffer.getChannelData(1);
    for (var i = 0; i < n; ++i) {
        channelL[i] = Math.sin(frequency * 2.0*Math.PI * i / sampleRate);
        channelR[i] = channelL[i];
    }
    return Q(audioBuffer);
}

function loadNoteCatalogue(buffer) {
  var numberOfNotes = 12;

  for (var i = 0; i < numberOfNotes; i++) 
  {
    noteCatalogue.push({ 
      buffer: buffer, 
      playbackRate: Math.pow(2, i / 12), 
      duration: 0.2
    });
  } 
  return noteCatalogue;
}

// sound is a wave. 
// the frequency, or hertz, is the note you hear. it affects how fast the wave oscillates.
// changing frequency changes the duration of the note, if you are using a fixed length source of 'wave'.
//       use .stop and .start with a duration, and loop the wave.
// clicks are produced when the frequency 'jumps', producing breaks in the wave.  
// It's a pipeline. Only one thing needs to output to your speakers! (context.destination)
// everything else - volume, distortion, etc. just chains from the source to the destination. 
// each audio buffer souce can only be played once. you need to recreate each new note to play.
// demo examples: 
//  -  plain notes
//  -  change stop time to add extra duration, + add linear ramp to value to the new duration
//  -  add multiple ramps up/down to introduce bouncing
//  -  add multiple oscillators to alternate the wave.

// problems - timeout is starting to lag with multiple notes playing.

function playSound(note) {
  time = context.currentTime;
  duration = note.duration;

  var source = context.createBufferSource(); // creates a sound source. needs to be done each time. 
  source.buffer = note.buffer;               // tell the source which sound to play
  source.playbackRate.value = note.playbackRate;
  source.loop = true;
  source.start(time);                           
  source.stop(time + (duration* 5));
  
  // var o1 = context.createOscillator();
  // o1.type = 'sine';
  // o1.frequency.value = 261.63;

  // var o2 = context.createOscillator();
  // o2.type = 'sine';
  // o2.frequency.value = 622.63;


  // add 'bounce' to note, and fade in/out to avoid clicks.
  var gainNode = context.createGain();
  gainNode.gain.value = 0;
  gainNode.gain.linearRampToValueAtTime(0.3, time + 0.05);
  gainNode.gain.linearRampToValueAtTime(1, time + 0.08);
  gainNode.gain.linearRampToValueAtTime(0.3, time + 0.1);
  gainNode.gain.exponentialRampToValueAtTime(0.01, time + (duration * 5));

  source.connect(gainNode);
  //o1.connect(o2);

  gainNode.connect(context.destination);       
}

function playNotesInColumn($elem) {
  $elem.children().each(function() {
    if ($(this).is(':checked')) {
      var note = noteCatalogue[$(this).val()-1];
      playSound(note);
    }
  });
  setTimeout(function() { playNotesInColumn($elem) }, 2000);
}

function loopSound() {
  $(".grid").children().each(function(index){
    var i = $(this);
    setTimeout(function() { 
      playNotesInColumn(i)
    }, index * 125);
  });
}

function init() {
  try {
    window.AudioContext = window.AudioContext||window.webkitAudioContext;
    context = new AudioContext();

  }
  catch(e) {
  	console.log(e);
    console.log('Web Audio API is not supported in this browser');
  }

  createSoundBuffer()
    .then(loadNoteCatalogue)
    .then(loopSound);
}

window.addEventListener('load', init, false);

</script>
</body>
</html>