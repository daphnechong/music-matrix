<html>
<head>
  <style>
    body { 
      margin: 0;
      padding: 0;
      border: 0;
      height: 100%;
      width: 100%;
      background: #252122;
    }

    input { display: block;}

    /* styling from http://jsfiddle.net/4bs8A/ */
    input[type=checkbox] {
          margin-top: -30px;
    }

    input[type='checkbox'] {
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeSpeed;
        width: 30px;
        height: 30px;
        margin: 1px;
        display: block;
        position: relative;
        cursor:pointer;
    }
    input[type='checkbox']:after {
        content:"";
        vertical-align: middle;
        text-align: center;
        position: absolute;
        cursor: pointer;
        height: 31px;
        width: 31px;
        left: 0px;
        top: 0px;
        -webkit-box-shadow: inset 0px 1px 1px #000, 0px 1px 0px #444;
        -moz-box-shadow: inset 0px 1px 1px #000, 0px 1px 0px #444;
        box-shadow: inset 0px 1px 1px #000, 0px 1px 0px #444;
        background: #45484d;
    }

    input[type='checkbox']:checked:after {
        background: #1c9099;
        color: #fff;
    }
        
    .grid div { 
      display: block; 
      float: left;
    }

    .grid {
      width: 550px;
      height: 550px;
      margin: 0 auto;
    }

    .intro {
      color: #f0f0f0;
      font-family: Lato, Arial, sans-serif;
      margin: 30 auto;
      width: 550px;
    }

    a {
      color: #fff;
    }
  </style>
</head>
<body>
<div class="intro">
  <p>The sound in this grid is powered by the Web Audio API.</p>
  <p>It represents two seconds of music, and repeats.
  <br/>The horizontal axis shows time, and the vertical axis the pitch of the note.</p>
  <p>You can activate a note by clicking on a square.</p>
  <p>This was a learning exercise inspired by <a href="http://tonematrix.audiotool.com">ToneMatrix</a>
</div>

<div class="grid">
  <div id="group-1">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
    <div id="group-2">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-3">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-4">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-5">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-6">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-7">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-8">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-9">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-10">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-11">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-12">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-13">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-14">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-15">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
  <div id="group-16">
    <input class="button" type="checkbox" value="1"/>
    <input class="button" type="checkbox" value="2"/>
    <input class="button" type="checkbox" value="3"/>
    <input class="button" type="checkbox" value="4"/>
    <input class="button" type="checkbox" value="5"/>
    <input class="button" type="checkbox" value="6"/>
    <input class="button" type="checkbox" value="7"/>
    <input class="button" type="checkbox" value="8"/>
    <input class="button" type="checkbox" value="9"/>
    <input class="button" type="checkbox" value="10"/>
    <input class="button" type="checkbox" value="11"/>
    <input class="button" type="checkbox" value="12"/>
    <input class="button" type="checkbox" value="13"/>
    <input class="button" type="checkbox" value="14"/>
    <input class="button" type="checkbox" value="15"/>
    <input class="button" type="checkbox" value="16"/>
  </div>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script>
//http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/
//http://www.softsynth.com/webaudio/tone.php
//http://noisehack.com/custom-audio-effects-javascript-web-audio-api/
// https://chromium.googlesource.com/external/WebKit_LayoutTests/+/master/webaudio/audiobuffersource-playbackrate.html

// this is a C major scale 
var frequencies = [
'261.63',  // c4
'293.66',  // d4
'329.63',  // e4
'349.23',  // f4
'392.00',  // g4
'440.00',  // a4
'493.88',  // b4
'523.25',  // c5
'587.33',  // d5
'659.25',  // e5
'698.46',  // f5
'783.99',  // g5
'880.00',  // a5
'987.77',  // b5 
'1046.50', // c6
'1174.66']  // d6

frequencies.reverse();

function playSound(index) {
  time = context.currentTime;
  fadeout = 1;
  
  // generate the sound wave at specified note frequency
  var osc = context.createOscillator();
  osc.type = 'sine';
  osc.frequency.value = frequencies[index];
  osc.start(time);
  osc.stop(time + fadeout);

  // add 'bounce' to note, and fade in/out to avoid clicks.
  var gainNode = context.createGain();
  gainNode.gain.value = 0;
  gainNode.gain.linearRampToValueAtTime(0.01, time + 0.02);
  gainNode.gain.linearRampToValueAtTime(0.5, time + 0.125);
  gainNode.gain.linearRampToValueAtTime(0.2, time + 0.130);
  gainNode.gain.exponentialRampToValueAtTime(0.01, time + fadeout);

  osc.connect(gainNode);
  gainNode.connect(context.destination);       
}

function playNotesInColumn($elem) {
  $elem.children(':checked').each(function() {
    playSound($(this).val() - 1);
  });

  // Repeat this column every 2 seconds, since there are 16 columns at 125ms intervals. 
  // This simple implementation of timeout isn't really a long term solution, it will start 
  // lagging eventually if cpu is processing other things when timeout is supposed to fire
  setTimeout(function() {
   playNotesInColumn($elem) 
  }, 2000); 

}

function loopSound() {
  // Kick off the loop. Each column represents 125ms worth of time.
  $(".grid").children().each(function(index){
    var i = $(this);
    setTimeout(function() { 
      playNotesInColumn(i)
    }, index * 125); 
  });
}

function init() {
  try {
    window.AudioContext = window.AudioContext||window.webkitAudioContext;
    context = new AudioContext();
  }
  catch(e) {
  	console.log(e);
    alert('Web Audio API is not supported in this browser.');
  }

  loopSound();
}

window.addEventListener('load', init, false);

</script>
</body>
</html>